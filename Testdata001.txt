/*
  Blink
  Turns on an LED on for one second, then off for one second, repeatedly.

  Most Arduinos have an on-board LED you can control. On the Uno and
  Leonardo, it is attached to digital pin 13. If you're unsure what
  pin the on-board LED is connected to on your Arduino model, check
  the documentation at http://www.arduino.cc

  This example code is in the public domain.

  modified 8 May 2014
  by Scott Fitzgerald
 */
  const int SystemOnLED =  13;  //D13 the number of the LED pin
  const int SystemOnSwitch = 6; //D6
//Wednesday TRIAL:
  const int Thermocouple = A1;  // Analog input pin that the potentiometer is attached to silmulate temprature sensor
  const int Heater =  10;      //D10 the number of the LED pin 
  const int AirPump =  5;  // D5 the number of the LED pin
  int ChamberTemperature =0;
  int LoopCounter =0;

  int Blink,Blinkspeed=0,LongPressCounter=0;
  int BATCHCOUNT =5, BatchCounter =0;
  boolean SystemKeyRead();

  
// the setup function runs once when you press reset or power the board
void setup() {
  // initialize digital pin 13 as an output.
  pinMode(SystemOnLED, OUTPUT);
  pinMode(SystemOnSwitch,INPUT);

  // Wednesday TRIAL:
  pinMode(Heater, OUTPUT);
  pinMode(AirPump, OUTPUT);
  pinMode(Thermocouple, INPUT);
  analogReference(EXTERNAL);
  //pinMode(A1, INPUT);
 
  Serial.begin(9600);
}

// the loop function runs over and over again forever
void loop() 
{
  
      if(SystemKeyRead())
      {
          Blink=1;
          if(LongPressCounter >=10)
          { 
            Serial.println(" Long Press....Heater OFF !!!");
            BatchCounter =0; Blink =0;
            digitalWrite(SystemOnLED, HIGH);   // turn the LED on (HIGH is the voltage level)
            //Wednesday TRIAL
            digitalWrite(Heater, LOW);  
          }else
              {
                  Serial.print("LongPressCounter else part: ");
                  Serial.println(LongPressCounter);
                  if(LongPressCounter++ >1){ Blink =0;  digitalWrite(SystemOnLED, LOW); }                
              }
      }else 
          {
            LongPressCounter = 0;
            if(!Blink)
            digitalWrite(SystemOnLED, LOW);    // turn the LED off by making the voltage LOW                
          }
      
      if( Blink )
      {
          if(Blinkspeed % 2==0)
            { 
              digitalWrite(SystemOnLED, HIGH);
             }else 
                 {
                    digitalWrite(SystemOnLED, LOW);
                 }
           if(Blinkspeed++ >=6)
           {Blink=0; Blinkspeed=0;           
           if(BatchCounter != BATCHCOUNT)
           {
              BatchCounter++;
              Serial.print("BatchCounter incremented : ");
           }else
                {
                 Serial.print("BatchCounter is : "); 
                 Serial.println(BatchCounter);
                 //Wednesday TRIAL
                 Serial.println(" Heater is switched  ON !");
                 digitalWrite(Heater, HIGH);
                 BatchCounter =0;                         
                }
           }
       }
  
  
  //Wednesday TRIAL        
  if(LoopCounter++ >=6)
  {
     LoopCounter =0;
     ChamberTemperature = analogRead(Thermocouple);
     Serial.print(" Chamber Temperature value = ");
     Serial.println(ChamberTemperature); 
  }
   
  if ( ChamberTemperature > 100 )
  {
    Serial.println(" Air pump is ON when Temp is greater than 100"); 
    digitalWrite(AirPump, HIGH);
  }


       
      delay(500);              // wait for a 500 millisecond
}

 boolean SystemKeyRead()
 { int  SystemOn1,SystemOn2;
   SystemOn1 = digitalRead(SystemOnSwitch);
   delay(25);
   SystemOn2 = digitalRead(SystemOnSwitch);
   if( ! (SystemOn1 ||SystemOn2))
   {
    Serial.println("System Key pressed ON");
    //digitalWrite(SystemOnLED, HIGH);
    return HIGH;
   }
   else
   return LOW;
  }
